<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>مصحف تكرار السور والآيات</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Lemonada:wght@400;700&display=swap');

        :root {
            --main-bg: #e3d5b8; 
            --accent: #b7903c;   
            --text-color: #3e2723;
            --quran-text-color: #2c3e50;
            --body-bg: #d2c4a7;
        }

        .dark-theme {
            --main-bg: #2c2c2c;
            --accent: #d4af37;
            --text-color: #e0e0e0;
            --quran-text-color: #f5f5f5;
            --body-bg: #1a1a1a;
        }

        body {
            font-family: 'Amiri', serif;
            background-color: var(--body-bg);
            background-image: url('https://www.transparenttextures.com/patterns/wood-pattern.png');
            margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh;
            overflow: hidden; flex-direction: column; transition: all 0.4s ease;
        }

        .top-header { text-align: center; margin-bottom: 15px; width: 90%; }
        .basmala { font-size: 1.6rem; color: var(--quran-text-color); margin-bottom: 10px; }
        .branding-container { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .app-logo {
            width: 70px; height: 70px;
            background-image: url('https://i.ibb.co/8LXwwR6Q/images.jpg'); 
            background-size: cover; border-radius: 50%; border: 3px solid var(--accent);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .app-name {
            font-family: 'Lemonada', cursive; font-size: 1.1rem;
            color: var(--accent); font-weight: bold; line-height: 1.4;
        }

        .main-window {
            width: 85%; max-width: 330px; background: var(--main-bg);
            padding: 15px; border-radius: 25px; border: 4px solid var(--accent);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3); text-align: center;
            transition: all 0.4s ease; color: var(--text-color);
        }

        .bottom-controls { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 20px; }
        .theme-switcher { display: flex; gap: 12px; background: rgba(255, 255, 255, 0.2); padding: 8px 15px; border-radius: 20px; }
        .theme-btn { width: 22px; height: 22px; border-radius: 50%; border: 2px solid white; cursor: pointer; transition: transform 0.2s; }
        .night-toggle-btn { background: var(--accent); color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-family: 'Amiri'; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.3s; }

        .play-btn { width: 65px; height: 65px; background: #fff; border: 3px solid var(--accent); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; }
        .play-icon { width: 0; height: 0; border-top: 12px solid transparent; border-bottom: 12px solid transparent; border-left: 20px solid var(--accent); margin-left: 5px; }
        .selection-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .select-group { flex: 1; text-align: right; }
        .select-group label { font-size: 0.75rem; margin-bottom: 2px; display: block; font-weight: bold; }
        select { width: 100%; padding: 5px; border-radius: 8px; border: 1px solid var(--accent); background: #fdfaf3; font-family: 'Amiri'; font-size: 0.8rem; }
        .controls-row { display: flex; gap: 8px; }
        .control-box { flex: 1; background: rgba(255,255,255,0.15); padding: 6px; border-radius: 12px; border: 1px solid var(--accent); }
        .btn-action { width: 22px; height: 22px; border-radius: 50%; border: none; background: var(--accent); color: white; cursor: pointer; }

        .reader-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .reader-card { width: 92%; height: 85vh; background: var(--main-bg); border-radius: 20px; position: relative; border: 4px solid var(--accent); display: flex; flex-direction: column; overflow: hidden; }
        .close-btn { position: absolute; top: 8px; right: 8px; width: 32px; height: 32px; background: #b13a3a; color: white; border: none; border-radius: 50%; cursor: pointer; z-index: 100; }
        .quran-scroll { flex-grow: 1; padding: 20px; overflow-y: auto; text-align: center; line-height: 2.2; font-size: 1.6rem; color: var(--quran-text-color); }
        .active-ayah { background: rgba(183, 144, 60, 0.3); border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>

<div class="top-header">
       <div class="branding-container">
        <div class="app-logo"></div>
        <div class="app-name">مصحف تكرار السور والآيات</div>
    </div>
</div>

<div class="main-window" id="mainWindow">
    <div class="play-btn" onclick="openReader()">
        <div class="play-icon"></div>
    </div>

    <div class="selection-row">
        <div class="select-group">
            <label>القارئ</label>
            <select id="reciter">
        <option value="https://everyayah.com/data/Muhammad_Ayyoub_128kbps/">محمد أيوب</option>     
       <option value="https://everyayah.com/data/Minshawy_Murattal_128kbps/">محمد صديق المنشاوي</option>
      <option value="https://everyayah.com/data/Husary_64kbps/" >محمود خليل الحصري</option>
      <option value="https://everyayah.com/data/Alafasy_128kbps/">مشاري العفاسي</option>
      <option value="https://everyayah.com/data/Maher_AlMuaiqly_64kbps/">ماهر المعيقلي</option>
     <option value="https://everyayah.com/data/Saood_ash-Shuraym_64kbps/">سعود الشريم</option>
    <option value="https://everyayah.com/data/Hudhaify_64kbps/">علي الحذيفي</option>
   <option value="https://everyayah.com/data/Yasser_Ad-Dussary_128kbps/">ياسر الدوسري</option>
   <option value="https://everyayah.com/data/Abdul_Basit_Murattal_64kbps/">عبدالباسط (مرتل)</option>

            </select>
        </div>
        <div class="select-group">
            <label>السورة</label>
            <select id="surahSelect" onchange="loadSurah(this.value)"></select>
        </div>
    </div>

    <div class="controls-row">
        <div class="control-box">
            <label>تكرار الآية</label>
            <div class="counter-ui">
                <button class="btn-action" onclick="changeVal('repeat', 1)">+</button>
                <span id="repeatVal">1</span>
                <button class="btn-action" onclick="changeVal('repeat', -1)">-</button>
            </div>
        </div>
        <div class="control-box">
            <label>السكتة (ث)</label>
            <div class="counter-ui">
                <button class="btn-action" onclick="changeVal('pause', 1)">+</button>
                <span id="pauseVal">0</span>
                <button class="btn-action" onclick="changeVal('pause', -1)">-</button>
            </div>
        </div>
    </div>
</div>

<div class="bottom-controls">
    <button class="night-toggle-btn" onclick="toggleNightMode()">تفعيل الوضع الليلي</button>
    <div class="theme-switcher">
        <div class="theme-btn" style="background-color: #e3d5b8;" onclick="setTheme('#e3d5b8', '#b7903c', '#d2c4a7')"></div>
        <div class="theme-btn" style="background-color: #d1e7dd;" onclick="setTheme('#d1e7dd', '#198754', '#a3cfbb')"></div>
        <div class="theme-btn" style="background-color: #cfe2ff;" onclick="setTheme('#cfe2ff', '#0d6efd', '#9ec5fe')"></div>
        <div class="theme-btn" style="background-color: #f8d7da;" onclick="setTheme('#f8d7da', '#dc3545', '#f1aeb5')"></div>
    </div>
</div>

<div class="reader-overlay" id="readerOverlay">
    <div class="reader-card">
        <button class="close-btn" onclick="closeReader()">✕</button>
        <div class="quran-scroll" id="quranText"></div>
    </div>
</div>

<audio id="audioPlayer"></audio>

<script>
    let ayahs = [];
    let currentSNum = 1;
    let currentAIdx = 0;
    let currentRep = 1;
    const audio = document.getElementById('audioPlayer');

    function toggleNightMode() {
        document.body.classList.toggle('dark-theme');
        const isDark = document.body.classList.contains('dark-theme');
        document.querySelector('.night-toggle-btn').innerText = isDark ? "تفعيل الوضع النهاري" : "تفعيل الوضع الليلي";
    }

    function setTheme(bg, accent, bodyBg) {
        document.body.classList.remove('dark-theme');
        document.querySelector('.night-toggle-btn').innerText = "تفعيل الوضع الليلي";
        document.documentElement.style.setProperty('--main-bg', bg);
        document.documentElement.style.setProperty('--accent', accent);
        document.documentElement.style.setProperty('--body-bg', bodyBg);
    }

    fetch('https://api.alquran.cloud/v1/surah')
        .then(r => r.json()).then(data => {
            const s = document.getElementById('surahSelect');
            s.innerHTML = data.data.map(item => `<option value="${item.number}">${item.name}</option>`).join('');
            loadSurah(1);
        });

    function loadSurah(num) {
        currentSNum = num;
        fetch(`https://api.alquran.cloud/v1/surah/${num}`)
            .then(r => r.json()).then(data => { ayahs = data.data.ayahs; });
    }

    function changeVal(id, amt) {
        let el = document.getElementById(id + 'Val');
        let v = parseInt(el.innerText) + amt;
        if (v >= 0) el.innerText = v;
    }

    function openReader() {
        document.getElementById('readerOverlay').style.display = 'flex';
        const container = document.getElementById('quranText');
        container.innerHTML = ayahs.map((a, i) => `<span class="ayah" id="a-${i}" onclick="playAyah(${i})">${a.text} ﴿${a.numberInSurah}﴾</span>`).join(' ');
        playAyah(0);
    }

    function closeReader() {
        audio.pause();
        document.getElementById('readerOverlay').style.display = 'none';
    }

    function playAyah(index) {
        currentAIdx = index; currentRep = 1;
        document.querySelectorAll('.ayah').forEach(el => el.classList.remove('active-ayah'));
        const active = document.getElementById(`a-${index}`);
        if(active) { active.classList.add('active-ayah'); active.scrollIntoView({ behavior: 'smooth', block: 'center' }); }

        const rec = document.getElementById('reciter').value;
        const s = currentSNum.toString().padStart(3, '0');
        const a = ayahs[index].numberInSurah.toString().padStart(3, '0');
        audio.src = `${rec}${s}${a}.mp3`;
        audio.play();

        audio.onended = () => {
            let max = parseInt(document.getElementById('repeatVal').innerText);
            let pause = parseInt(document.getElementById('pauseVal').innerText) * 1000;
            if (currentRep < max) {
                currentRep++;
                setTimeout(() => audio.play(), pause);
            } else if (currentAIdx + 1 < ayahs.length) {
                setTimeout(() => playAyah(currentAIdx + 1), pause);
            }
        };
    }
</script>
</body>
</html>